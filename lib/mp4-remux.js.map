{"version":3,"file":"mp4-remux.js","sources":["../src/boxes.class/Mp4Box.class.ts","../src/boxes.class/trex.ts","../src/boxes.class/trun.ts","../src/boxes.class/tfdt.ts","../src/boxes.class/tfhd.ts","../src/boxes.class/traf.ts","../src/boxes.class/mfhd.ts","../src/boxes.class/udta.ts","../src/boxes.class/mdia.ts","../src/boxes.class/ftyp.ts","../src/boxes.class/free.ts","../src/boxes.class/moov.ts","../src/boxes.class/moof.ts","../src/boxes.class/sidx.ts","../src/boxes.class/mdat.ts","../src/boxes.class/mvhd.ts","../src/boxes.class/mvex.ts","../src/boxes.class/tkhd.ts","../src/boxes.class/trak.ts","../src/boxes.class/edts.ts","../src/Mp4Stream.class.ts","../src/index.ts"],"sourcesContent":["import { Box } from \"./types\";\r\nimport * as Boxes from \".\";\r\n\r\nexport class Mp4Box {\r\n  stream: Uint8Array = new Uint8Array();\r\n  dv: DataView = new DataView(new Uint8Array().buffer);\r\n  boxs: Box[] = [];\r\n  boxPos = 0; // 记录元数据和盒子数据的偏差\r\n\r\n  constructor(buf: Uint8Array) {\r\n    this.stream = buf;\r\n    this.dv = new DataView(buf.buffer);\r\n  }\r\n\r\n  set size(value: number) {\r\n    this.writeUint(4, value);\r\n  }\r\n  get size() {\r\n    return this.readUint(4);\r\n  }\r\n  get type() {\r\n    return this.readString(4, 4);\r\n  }\r\n\r\n  /**\r\n   * 获取当前 box 的 binary\r\n   */\r\n  get raw() {\r\n    if (this.boxPos) {\r\n      let size = this.boxPos;\r\n      const bufs = this.boxs.map((item) => {\r\n        const boxRaw = item.raw;\r\n        size += boxRaw.length;\r\n        return boxRaw;\r\n      });\r\n      this.size = size;\r\n      const base = this.stream.slice(0, this.boxPos);\r\n\r\n      // 将 Uint8Array[] 合并成一个\r\n      const nbuf = new Uint8Array(size);\r\n      let pos = 0;\r\n      for (const item of [base, ...bufs]) {\r\n        nbuf.set(item, pos);\r\n        pos += item.length;\r\n      }\r\n      return nbuf;\r\n    }\r\n\r\n    return this.stream;\r\n  }\r\n  writeUint(size: 1 | 2 | 4, val: number, pos = 0) {\r\n    const view = this.dv;\r\n    switch (size) {\r\n      case 1:\r\n        view.setUint8(pos, val);\r\n        break;\r\n      case 2:\r\n        view.setUint16(pos, val);\r\n        break;\r\n      case 4:\r\n        view.setUint32(pos, val);\r\n        break;\r\n    }\r\n  }\r\n  writeInt(size: 1 | 2 | 4, val: number, pos = 0) {\r\n    const view = this.dv;\r\n    switch (size) {\r\n      case 1:\r\n        view.setInt8(pos, val);\r\n        break;\r\n      case 2:\r\n        view.setInt16(pos, val);\r\n        break;\r\n      case 4:\r\n        view.setInt32(pos, val);\r\n        break;\r\n    }\r\n  }\r\n\r\n  readInt(size: 1 | 2 | 4 = 4, pos = 0) {\r\n    const view = this.dv;\r\n    switch (size) {\r\n      case 1:\r\n        return view.getInt8(pos);\r\n      case 2:\r\n        return view.getInt16(pos);\r\n      case 4:\r\n        return view.getInt32(pos);\r\n    }\r\n  }\r\n\r\n  // use dataView to Get Unsigned Int\r\n  readUint(size: 1 | 2 | 4, pos = 0) {\r\n    const view = this.dv;\r\n    switch (size) {\r\n      case 1:\r\n        return view.getUint8(pos);\r\n      case 2:\r\n        return view.getUint16(pos);\r\n      case 4:\r\n        return view.getUint32(pos);\r\n    }\r\n  }\r\n  /**\r\n   * Read string by char code from Uint8Array\r\n   * @param size\r\n   */\r\n  readString(size: 4, pos = 0) {\r\n    let s = \"\";\r\n    for (let i = 0; i < size; i++) {\r\n      s += String.fromCharCode(this.readUint(1, pos + i));\r\n    }\r\n    return s;\r\n  }\r\n\r\n  parse(boxPos: number) {\r\n    this.boxPos = boxPos;\r\n    let pos = boxPos;\r\n    while (pos <= this.stream.length - 8) {\r\n      const size = this.readUint(4, pos);\r\n      const type = this.readString(4, 4 + pos);\r\n      if (size <= this.stream.length) {\r\n        const tBuf = this.stream.slice(pos, pos + size);\r\n\r\n        const BoxClass = Boxes[type as keyof typeof Boxes] || Boxes.free;\r\n        this.boxs.push(new BoxClass(tBuf));\r\n      }\r\n      pos += size;\r\n    }\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class trex extends Mp4Box {\r\n\r\n  get version() {\r\n    return this.readUint(1, 8);\r\n  }\r\n  get track_id():number{\r\n    return this.readUint(4,12);\r\n  }\r\n  set track_id(value){\r\n    this.writeUint(4,value,12);\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class trun extends Mp4Box {\r\n  get sample_count() {\r\n    return this.readUint(4, 12);\r\n  }\r\n  get data_offset() {\r\n    return this.readInt(4, 16);\r\n  }\r\n  set data_offset(val) {\r\n    this.writeInt(4, val, 16);\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class tfdt extends Mp4Box {}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class tfhd extends Mp4Box {\r\n  get version() {\r\n    return this.readUint(1, 8);\r\n  }\r\n  get track_id():number{\r\n    return this.readUint(4,12);\r\n  }\r\n  set track_id(value){\r\n    this.writeUint(4,value,12);\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\nimport { trun, tfhd } from \".\";\r\n\r\nexport class traf extends Mp4Box {\r\n  constructor(buf: Uint8Array) {\r\n    super(buf);\r\n    this.parse(8);\r\n  }\r\n  get tfhd() {\r\n    return this.boxs.find((box) => box instanceof tfhd) as tfhd;\r\n  }\r\n  get trun() {\r\n    return this.boxs.find((box) => box instanceof trun) as trun;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class mfhd extends Mp4Box {\r\n  get sequence_number() {\r\n    return this.readUint(4, 12);\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class udta extends Mp4Box {}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class mdia extends Mp4Box {}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class ftyp extends Mp4Box {}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class free extends Mp4Box {}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\nimport { mvhd, mvex, trak } from \".\";\r\n\r\nexport class moov extends Mp4Box {\r\n  constructor(buf: Uint8Array) {\r\n    super(buf);\r\n    this.parse(8);\r\n  }\r\n\r\n  get mvhd() {\r\n    return this.boxs.find((box) => box instanceof mvhd) as mvhd;\r\n  }\r\n  get mvex(){\r\n    return this.boxs.find((box) => box instanceof mvex) as mvex;\r\n  }\r\n  get trak(){\r\n    return this.boxs.find((box) => box instanceof trak) as trak;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\nimport { mfhd, traf } from \"./\";\r\n\r\nexport class moof extends Mp4Box {\r\n  constructor(buf: Uint8Array) {\r\n    super(buf);\r\n    this.parse(8);\r\n  }\r\n  get mfhd(){\r\n    return this.boxs.find((box) => box instanceof mfhd) as mfhd\r\n  }\r\n  get traf(){\r\n    return this.boxs.find((box) => box instanceof traf) as traf\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class sidx extends Mp4Box {\r\n  get version() {\r\n    return this.readUint(1, 8);\r\n  }\r\n  get reference_ID() {\r\n    return this.readUint(4, 12);\r\n  }\r\n  get timescale() {\r\n    return this.readUint(4, 16);\r\n  }\r\n  get reserved() {\r\n    let offset = 8 + 20;\r\n    if (this.version !== 0) {\r\n      offset = 16 + 20;\r\n    }\r\n    return this.readUint(2, offset);\r\n  }\r\n  get reference_count() {\r\n    let offset = 8 + 20;\r\n    if (this.version !== 0) {\r\n      offset = 16 + 20;\r\n    }\r\n    offset += 2;\r\n    return this.readUint(2, offset);\r\n  }\r\n  get refList() {\r\n    let offset = 8 + 24;\r\n    if (this.version !== 0) {\r\n      offset = 16 + 24;\r\n    }\r\n    const refrenceCount = this.reference_count;\r\n    const resList = [];\r\n    for (let i = 0; i < refrenceCount; i++) {\r\n      const pos = offset + i * 12; // Position\r\n      let tmp_32 = this.readUint(4, pos);\r\n      const reference_type = (tmp_32 >> 31) & 0x1;\r\n      const referenced_size = tmp_32 & 0x7fffffff;\r\n      const subsegment_duration = this.readUint(4, pos + 4);\r\n      tmp_32 = this.readUint(4, pos + 8);\r\n      const starts_with_SAP = (tmp_32 >> 31) & 0x1;\r\n      const SAP_type = (tmp_32 >> 28) & 0x7;\r\n      const SAP_delta_time = tmp_32 & 0xfffffff;\r\n      resList.push({\r\n        reference_type,\r\n        referenced_size,\r\n        subsegment_duration,\r\n        starts_with_SAP,\r\n        SAP_type,\r\n        SAP_delta_time,\r\n      });\r\n    }\r\n    return resList;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class mdat extends Mp4Box {\r\n  push(value: Uint8Array) {\r\n    // 向 stream 追加数据\r\n\r\n    const newBuf = new Uint8Array(this.stream.length + value.length);\r\n    newBuf.set(this.stream);\r\n    newBuf.set(value, this.stream.length);\r\n    this.stream = newBuf;\r\n    this.dv = new DataView(this.stream.buffer);\r\n    this.size = newBuf.length;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class mvhd extends Mp4Box {\r\n\r\n  get version() {\r\n    return this.readUint(1, 8);\r\n  }\r\n\r\n  get next_track_ID(){\r\n    if(this.version === 0){\r\n      return this.readUint(4,104);\r\n    }else{\r\n      return this.readUint(4,116);\r\n    }\r\n  }\r\n  set next_track_ID(value){\r\n    if(this.version === 0){\r\n      this.writeUint(4,value,104);\r\n    }else{\r\n      this.writeUint(4,value,116);\r\n    }\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\nimport { trex } from \"./\";\r\n\r\nexport class mvex extends Mp4Box {\r\n  constructor(buf: Uint8Array) {\r\n    super(buf);\r\n    this.parse(8);\r\n\r\n\r\n  }\r\n  get trex(){\r\n    return this.boxs.find((box) => box instanceof trex) as trex;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class tkhd extends Mp4Box {\r\n  get version() {\r\n    return this.readUint(1, 8);\r\n  }\r\n\r\n  get track_id():number{\r\n    if(this.version === 1){\r\n      return this.readUint(4, 28);\r\n    }else{\r\n      return this.readUint(4,20);\r\n    }\r\n  }\r\n  set track_id(value){\r\n    if(this.version === 1){\r\n      this.writeUint(4,value,28);\r\n    }else{\r\n      this.writeUint(4,value,20);\r\n    }\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\nimport { tkhd } from \"./tkhd\";\r\n\r\nexport class trak extends Mp4Box {\r\n  constructor(buf: Uint8Array) {\r\n    super(buf);\r\n    this.parse(8);\r\n  }\r\n  get tkhd(): tkhd {\r\n    return this.boxs.find((box) => box instanceof tkhd) as tkhd;\r\n  }\r\n}\r\n","import { Mp4Box } from \"./Mp4Box.class\";\r\n\r\nexport class edts extends Mp4Box {}\r\n","import * as Boxes from \"./boxes.class\";\r\nimport { Box } from \"./boxes.class/types\";\r\n\r\nexport class Mp4Stream {\r\n  stream: Uint8Array = new Uint8Array();\r\n  dv: DataView = new DataView(new Uint8Array().buffer);\r\n  boxs: Box[] = [];\r\n  isEnd = false;\r\n\r\n  get sidx() {\r\n    return this.boxs.find((box) => box instanceof Boxes.sidx) as Boxes.sidx;\r\n  }\r\n  get moov() {\r\n    return this.boxs.find((box) => box instanceof Boxes.moov) as Boxes.moov;\r\n  }\r\n\r\n  push(value: Uint8Array) {\r\n    const newBuf = new Uint8Array(this.stream.length + value.length);\r\n    newBuf.set(this.stream);\r\n    newBuf.set(value, this.stream.length);\r\n    this.stream = newBuf;\r\n    this.dv = new DataView(this.stream.buffer);\r\n  }\r\n\r\n  /**\r\n   * 将stream 截断，把pos前的数据返回，然后更新dataView\r\n   * @param pos\r\n   */\r\n  slice(pos: number) {\r\n    const sliceBuf = this.stream.slice(0, pos);\r\n    const newBuf = new Uint8Array(this.stream.length - pos);\r\n    newBuf.set(this.stream.slice(pos));\r\n    this.stream = newBuf;\r\n    this.dv = new DataView(this.stream.buffer);\r\n    return sliceBuf;\r\n  }\r\n  // use dataView to Get Unsigned Int\r\n  readUint(size: 1 | 2 | 4, pos = 0) {\r\n    const view = this.dv;\r\n    switch (size) {\r\n      case 1:\r\n        return view.getUint8(pos);\r\n      case 2:\r\n        return view.getUint16(pos);\r\n      case 4:\r\n        return view.getUint32(pos);\r\n    }\r\n  }\r\n  /**\r\n   * Read string by char code from Uint8Array\r\n   * @param size\r\n   */\r\n  readString(size: 4, pos = 0) {\r\n    let s = \"\";\r\n    for (let i = 0; i < size; i++) {\r\n      s += String.fromCharCode(this.readUint(1, pos + i));\r\n    }\r\n    return s;\r\n  }\r\n  parse() {\r\n    // 检查this.stream 的长度是否足够 2*4*8\r\n    if (this.stream.length < 8) {\r\n      return; // Not Enough\r\n    }\r\n\r\n    const size = this.readUint(4);\r\n    const type = this.readString(4, 4);\r\n\r\n    if (size <= this.stream.length) {\r\n      const tBuf = this.slice(size);\r\n\r\n      const BoxClass = Boxes[type as keyof typeof Boxes] || Boxes.free;\r\n      this.boxs.push(new BoxClass(tBuf));\r\n\r\n      this.parse(); // 继续向后解析\r\n    }\r\n  }\r\n\r\n  end() {\r\n    this.isEnd = true;\r\n  }\r\n}\r\n","import { Mp4Stream } from \"./Mp4Stream.class\";\r\nimport * as Boxes from \"./boxes.class\";\r\n\r\nexport default function remux(vs: ReadableStream, as: ReadableStream) {\r\n  //  读取两个stream的数据\r\n  const videoReader = vs.getReader();\r\n  const audioReader = as.getReader();\r\n\r\n  const videoStream = new Mp4Stream();\r\n  const audioStream = new Mp4Stream();\r\n\r\n  const { readable, writable } = new TransformStream();\r\n  const writer = writable.getWriter();\r\n\r\n  let status = -1;\r\n\r\n  function callWrite(buf: Uint8Array) {\r\n    writer.write(buf);\r\n  }\r\n\r\n  async function checkStream() {\r\n    if (status === -1) {\r\n      // 合并 moov 中的 track 信息\r\n      const videoMoov = videoStream.moov;\r\n      const audioMoov = audioStream.moov;\r\n      if (videoMoov && audioMoov) {\r\n\r\n        const videoMvex = videoMoov.mvex;\r\n        const audioMvex = audioMoov.mvex;\r\n        if (videoMvex && audioMvex) {\r\n          const videoTrex = videoMvex.trex;\r\n          const audioTrex = audioMvex.trex;\r\n\r\n          videoTrex.track_id = 1;\r\n          audioTrex.track_id = 2;\r\n\r\n          // console.log(videoMvex, audioMvex);\r\n          videoMvex.boxs = videoMvex.boxs.filter(item=>!(item instanceof Boxes.trex));\r\n          videoTrex && videoMvex.boxs.push(videoTrex);\r\n          audioTrex && videoMvex.boxs.push(audioTrex);\r\n        }\r\n\r\n        const videoTrak = videoMoov.trak;\r\n        const audioTrak = audioMoov.trak;\r\n        if (videoTrak && audioTrak) {\r\n          videoTrak.tkhd.track_id = 1;\r\n          audioTrak.tkhd.track_id = 2;\r\n\r\n          videoMoov.boxs.push(audioTrak);\r\n          for (const item of videoStream.boxs) {\r\n            callWrite(item.raw);\r\n            if (item === videoMoov) {\r\n              break;\r\n            }\r\n          }\r\n          status = 1;\r\n        }\r\n      }\r\n    }\r\n\r\n    // 需要先有 sidx\r\n    if (!videoStream.sidx || !audioStream.sidx) {\r\n      return;\r\n    }\r\n\r\n    if (status !== -1) {\r\n      const videoMaxIndex = videoStream.sidx.reference_count;\r\n      const audioMaxIndex = audioStream.sidx.reference_count;\r\n      if (status <= videoMaxIndex && status <= audioMaxIndex) {\r\n        // 合并\r\n\r\n        // Step1 获取需要的分片数据\r\n        const videoMoof = videoStream.boxs.find((item) => {\r\n          return (\r\n            item instanceof Boxes.moof && item?.mfhd.sequence_number === status\r\n          );\r\n        }) as Boxes.moof;\r\n        const audioMoof = audioStream.boxs.find((item) => {\r\n          return (\r\n            item instanceof Boxes.moof && item?.mfhd.sequence_number === status\r\n          );\r\n        }) as Boxes.moof;\r\n        const videoData = videoMoof && (videoStream.boxs[videoStream.boxs.indexOf(videoMoof) + 1] as Boxes.mdat);\r\n        const audioData = audioMoof && (audioStream.boxs[audioStream.boxs.indexOf(audioMoof) + 1] as Boxes.mdat);\r\n\r\n        if (videoMoof && videoData && audioMoof && audioData) {\r\n          // 处理合并流程\r\n          const videoTraf = videoMoof.traf;\r\n          const audioTraf = audioMoof.traf;\r\n\r\n          videoTraf.tfhd.track_id = 1;\r\n          audioTraf.tfhd.track_id = 2;\r\n          if (videoTraf?.trun && audioTraf?.trun) {\r\n            const audioTrafSize = audioTraf.size;\r\n            const videoMoofSize = videoMoof.size;\r\n            const videoDataSize = videoData.size;\r\n            videoTraf.trun.data_offset = videoMoofSize + audioTrafSize + 8;\r\n            audioTraf.trun.data_offset = videoMoofSize + audioTrafSize + videoDataSize;\r\n\r\n            videoMoof.boxs.push(audioTraf);\r\n\r\n            callWrite(videoMoof.raw);\r\n\r\n            // 处理 mdat 合并\r\n            videoData.push(audioData.raw.slice(8));\r\n            callWrite(videoData.raw);\r\n\r\n            // 释放存储空间\r\n            videoStream.boxs = videoStream.boxs.filter((item) => item !== videoMoof);\r\n            videoStream.boxs = videoStream.boxs.filter((item) => item !== videoData);\r\n            audioStream.boxs = audioStream.boxs.filter((item) => item !== audioMoof);\r\n            audioStream.boxs = audioStream.boxs.filter((item) => item !== audioData);\r\n\r\n            status += 1;\r\n            checkStream();\r\n          }\r\n        }\r\n      } else if (status > videoMaxIndex && status <= audioMaxIndex) {\r\n        // 追加 audio\r\n        const audioMoof = audioStream.boxs.find((item) => {\r\n          return (\r\n            item instanceof Boxes.moof && item?.mfhd.sequence_number === status\r\n          );\r\n        }) as Boxes.moof;\r\n        audioMoof.traf.tfhd.track_id = 2;\r\n        const audioData = audioMoof && (audioStream.boxs[audioStream.boxs.indexOf(audioMoof) + 1] as Boxes.mdat);\r\n        if (audioMoof && audioData) {\r\n          callWrite(audioMoof.raw);\r\n          callWrite(audioData.raw);\r\n          status += 1;\r\n          checkStream();\r\n        }\r\n      } else if (status > audioMaxIndex && status <= videoMaxIndex) {\r\n        // 追加 Video\r\n        const videoMoof = videoStream.boxs.find((item) => {\r\n          return (\r\n            item instanceof Boxes.moof && item?.mfhd.sequence_number === status\r\n          );\r\n        }) as Boxes.moof;\r\n        videoMoof.traf.tfhd.track_id = 1;\r\n        const videoData = videoMoof && (videoStream.boxs[videoStream.boxs.indexOf(videoMoof) + 1] as Boxes.mdat);\r\n        if (videoMoof && videoData) {\r\n          callWrite(videoMoof.raw);\r\n          callWrite(videoData.raw);\r\n          status += 1;\r\n          checkStream();\r\n        }\r\n      } else if (status > videoMaxIndex && status > audioMaxIndex) {\r\n        // end\r\n        status = -2;\r\n        // console.log(\"call close\", status, videoMaxIndex, audioMaxIndex);\r\n        // writer.releaseLock();\r\n        writer.close();\r\n      }\r\n    }\r\n  }\r\n\r\n  // 并行读取两个reader的数据\r\n  async function readerHandler(streamReader: ReadableStreamDefaultReader<any>, mp4Stream: Mp4Stream) {\r\n    while (true) {\r\n      const { done, value } = await streamReader.read();\r\n      if (value) {\r\n        mp4Stream.push(value);\r\n        mp4Stream.parse();\r\n\r\n        checkStream();\r\n      }\r\n      // 将value拼接到 chunk后\r\n\r\n      if (done) {\r\n        mp4Stream.end();\r\n        checkStream();\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  readerHandler(videoReader, videoStream);\r\n  readerHandler(audioReader, audioStream);\r\n  return readable;\r\n}\r\n"],"names":["Mp4Box","buf","__publicField","value","size","bufs","item","boxRaw","base","nbuf","pos","val","view","s","i","boxPos","type","tBuf","BoxClass","Boxes","Boxes.free","trex","trun","tfdt","tfhd","traf","box","mfhd","udta","mdia","ftyp","free","moov","mvhd","mvex","trak","moof","sidx","offset","refrenceCount","resList","tmp_32","reference_type","referenced_size","subsegment_duration","starts_with_SAP","SAP_type","SAP_delta_time","mdat","newBuf","tkhd","edts","Mp4Stream","Boxes.sidx","Boxes.moov","sliceBuf","remux","vs","as","videoReader","audioReader","videoStream","audioStream","readable","writable","writer","status","callWrite","checkStream","videoMoov","audioMoov","videoMvex","audioMvex","videoTrex","audioTrex","Boxes.trex","videoTrak","audioTrak","videoMaxIndex","audioMaxIndex","videoMoof","Boxes.moof","audioMoof","videoData","audioData","videoTraf","audioTraf","audioTrafSize","videoMoofSize","videoDataSize","readerHandler","streamReader","mp4Stream","done"],"mappings":"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"}